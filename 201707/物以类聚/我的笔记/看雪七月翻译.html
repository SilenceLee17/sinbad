<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="exporter-version" content="Evernote Mac 6.11.1 (455061)"/><meta name="author" content="184251289@qq.com"/><meta name="created" content="2017-07-01 06:21:54 +0000"/><meta name="source" content="desktop.mac"/><meta name="updated" content="2017-07-22 16:03:55 +0000"/><title>看雪七月翻译</title></head><body><div>joker：使用joker抽取iOS 11的kernelcache</div><div><a style="color: rgb(0, 0, 0);" href="http://newosxbook.com/tools/joker.html">http://newosxbook.com/tools/joker.html</a></div><h1 style="font-size: xx-large; font-family: Tahoma; font-variant-caps: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: xx-large; font-family: Tahoma; font-variant-caps: normal; letter-spacing: normal; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Joker</span></h1><div><img src="%E7%9C%8B%E9%9B%AA%E4%B8%83%E6%9C%88%E7%BF%BB%E8%AF%91.resources/94299BF9-A6EB-4FAB-AF4A-8ECBF2F4092E.jpg" height="436" width="300"/><br/></div><div style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; orphans: auto; widows: auto;">Joker</span><span style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; orphans: auto; widows: auto;"> is a quick and dirty iOS kernelcache handling utility I've written to assist in my reverse engineering. Apple tries their damn hardest to make reversing the kernel as hard as possible: With every release, more symbols are stripped. The kernelcache, being prelinked, requires less symbols to begin with (and tables in memory, as all LINKEDIT segments, are jettisoned). And - let's not forget - the kernelcache is encrypted. 32-bit kernelcaches can be decrypted thanks to the holy work by @xerub and others, but no 64-bit kernelcache keys exist (publicly), and the only way to "see" the kernel is by dumping it.</span></div><div style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">Joker是</span><span style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">为帮助我的逆向工程而开发，他是</span><span style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">一个快速而肮脏的iOS内核缓存处理实用程序。 苹果尽可能地让内核逆向变得困难：随着每个版本，更多的符号被剥离。 预链接的内核缓存需要较少的符号（内存中的表，所有的linkedit段，被抛弃）。 而且我们不要忘记 - 内核缓存是加密的。 由于@xerub和其他人的努力，32位内核缓存可以被解密，但是没有64位的内核缓存（公开）密钥存在，唯一的方法是通过倒推来“看”内核。</span></div><div style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><br/></div><div style="text-indent: 2em; font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-align: start; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="text-indent: 2em; font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; orphans: auto; widows: auto;">This hasn't stopped jailbreakers in the past, and will hopefully not stop us in the future. </span><span style="text-indent: 2em; font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; orphans: auto; widows: auto;">joker</span><span style="text-indent: 2em; font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; orphans: auto; widows: auto;"> is another humble contribution I can provide to the community, and to all reversers out there. It uses the same machlib as its sibling </span><span style="text-indent: 2em; font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; orphans: auto; widows: auto;">jtool</span><span style="text-indent: 2em; font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; orphans: auto; widows: auto;">, and the two in fact can finally play well together (see below)</span></div><div style="text-indent: 2em; font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-align: start; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="text-indent: 2em; font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">过去这些困难没能阻止越狱者，希望今后也如此。 Joker是我提供给社区和所有的逆向者的一点卑微贡献。 它使用与其兄弟工具jtool相同的machlib，而实际上它们可以一起玩得很好（见下文）</span></div><div style="text-indent: 2em; font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-align: start; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="text-indent: 2em; font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; orphans: auto; widows: auto;">The tool is primarily designed for iOS (naturally), but since the XNU data structures are pretty much identical, it works pretty well with some switches (</span><span style="text-indent: 2em; font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; orphans: auto; widows: auto;">-m</span><span style="text-indent: 2em; font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; orphans: auto; widows: auto;">, </span><span style="text-indent: 2em; font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; orphans: auto; widows: auto;">-s</span><span style="text-indent: 2em; font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; orphans: auto; widows: auto;">) on the OS X kernel, as well.</span></div><div style="text-indent: 2em; font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-align: start; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="text-indent: 2em; font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">该工具主要是针对iOS设计的。由于XNU数据结构几乎相同，同时它在OS X内核上的一些switches（-m，-s）也运行的很好。</span></div><div style="text-indent: 2em; font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-align: start; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><br style="text-indent: 2em; font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-align: start; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"/></div><h2 style="font-size: x-large; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: silver; font-family: Tahoma; font-variant-caps: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: x-large; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: silver; font-family: Tahoma; font-variant-caps: normal; letter-spacing: normal; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Usage Examples</span></h2><div>用法示例</div><h3 style="font-family: Tahoma; font-variant-caps: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-family: Tahoma; font-variant-caps: normal; letter-spacing: normal; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Basic</span></h3><div>基础</div><div style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; orphans: auto; widows: auto;">With no arguments, </span><span style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; orphans: auto; widows: auto;">joker</span><span style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; orphans: auto; widows: auto;"> will strive to explain itself:</span></div><div style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">毫无疑问，joker会努力解释自己：</span></div><div>Zephyr:JTool morpheus$ <span style="font-weight: bold;">joker</span></div><div>Usage: joker [-j] [-MmaSsKk] _filename_</div><div> _filename_ should be a decrypted iOS kernelcache, or kernel dump. </div><div><br/></div><div> -m: dump Mach Traps and MIG tables (NEW)</div><div> -a: dump everything</div><div> -k: dump kexts</div><div> -K: kextract [kext_bundle_id_or_name_shown_in_-k|all]</div><div> -S: dump sysctls</div><div> -s: dump UNIX syscalls</div><div> -j: Jtool compatible output (to companion file)</div><div><br/></div><div>2.2.1 (w/64 kextraction, MIG) Stable version (and kextraction on 64-bit!)</div><div> Tested on ARMv7/s 3.x-9.21b1, and ARM64 8.x/9.21b1</div><div><br/></div><div><br/></div><div style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; orphans: auto; widows: auto;">With just a filename, it will provide you with a brief identification of the file in question, by looking at the LC_SOURCE_VERSION. It will also print the sysent table address.</span></div><div style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">只需一个文件名，它将通过查看LC_SOURCE_VERSION为您提供有关文件的简要标识。 它也将打印sysent表地址。</span></div><div>Zephyr:JTool morpheus$ <span style="font-weight: bold;">joker ~/Documents/iOS/9b/kernel.9b.4S.decrypted</span></div><div>Source Version:          3216.0.0.1.15</div><div>This is iOS 9.x, or later</div><div>Found iOS 8+ sysent table @3eb684 (Addr: 0x803ec684)</div><div><br/></div><h3 style="font-family: Tahoma; font-variant-caps: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-family: Tahoma; font-variant-caps: normal; letter-spacing: normal; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">32-bit</span></h3><div style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; orphans: auto; widows: auto;">Since 32-bit kernelcaches can be obtained in entirety, before </span><span style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; orphans: auto; widows: auto;">LINKEDIT</span><span style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; orphans: auto; widows: auto;"> and </span><span style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; orphans: auto; widows: auto;">PRELINK_INFO</span><span style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; orphans: auto; widows: auto;"> are removed, </span><span style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; orphans: auto; widows: auto;">joker </span><span style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; orphans: auto; widows: auto;">can both list as well as extract kexts (what I call 'kextract’):</span></div><div style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">由于可以完全获得32位内核缓存，因此在删除LINKEDIT和PRELINK_INFO之前，joker可以同时列出并提取kexts（我称之为“kextract”）：</span></div><div>Zephyr:JTool morpheus$ <span style="font-weight: bold;">joker -k ~/Documents/iOS/9b/kernel.9b.4S.decrypted | more</span></div><div>Source Version:          3216.0.0.1.15</div><div>This is iOS 9.x, or later</div><div>Found iOS 8+ sysent table @3eb684 (Addr: 0x803ec684)</div><div>Processing kexts</div><div>OFFSET: 1095000</div><div>0x804ba000: Mach Kernel Pseudoextension (com.apple.kpi.mach)</div><div>0x804bc000: Unsupported Pseudoextension (com.apple.kpi.unsupported)</div><div>0x804bf000: Private Pseudoextension (com.apple.kpi.private)</div><div>0x804c5000: I/O Kit Pseudoextension (com.apple.kpi.iokit)</div><div>0x804df000: Libkern Pseudoextension (com.apple.kpi.libkern)</div><div>..</div><div>0x810d2000: tlsnke (com.apple.nke.tls)</div><div>0x810da000: AppleDiagnosticDataAccessReadOnly (com.apple.driver.AppleDiagnosticDataAccessReadOnly)</div><div>0x810dd000: AppleA5IOP (com.apple.driver.AppleA5IOP)</div><div>Got 171 kexts</div><div><br/></div><div style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; orphans: auto; widows: auto;">To extract, simply specify the name of the kext , </span><span style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; orphans: auto; widows: auto; font-weight: bold;">not </span><span style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; orphans: auto; widows: auto;">the bundle ID (annoying because of spaces, I know - but I'll add that in later)</span></div><div style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">要提取，只需指定kext的名称，而不是bundle ID（我知道会产生空格的烦恼，稍后会解决它）</span></div><div style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><br style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"/></div><div><br/></div><div><span style="text-decoration: line-through;"># First locate kext</span></div><div><span style="text-decoration: line-through;">Zephyr:JTool morpheus$ </span><span style="font-weight: bold; text-decoration: line-through;">joker -k ~/Documents/iOS/9b/kernel.9b.4S.decrypted | grep sandbox</span></div><div><span style="text-decoration: line-through;">0x80e50000: Seatbelt sandbox policy (com.apple.security.sandbox)</span></div><div><span style="text-decoration: line-through;"># Now extract</span></div><div><span style="text-decoration: line-through;">Zephyr:JTool morpheus$ </span><span style="font-weight: bold; text-decoration: line-through;">joker -e "Seatbelt sandbox policy" ~/Documents/iOS/9b/kernel.9b.4S.decrypted </span></div><div><span style="text-decoration: line-through;">Source Version:          3216.0.0.1.15</span></div><div><span style="text-decoration: line-through;">This is iOS 9.x, or later</span></div><div><span style="text-decoration: line-through;">Found iOS 8+ sysent table @3eb684 (Addr: 0x803ec684)</span></div><div><span style="text-decoration: line-through;">Processing kexts</span></div><div><span style="text-decoration: line-through;">Attempting to kextract Seatbelt sandbox policy</span></div><div><span style="text-decoration: line-through;">Found Seatbelt sandbox policy at load address: 80e50000, offset: e05000</span></div><div><span style="text-decoration: line-through;">Extracted Seatbelt sandbox policy</span></div><div><span style="text-decoration: line-through;"># extracted kext will be dropped to same directory</span></div><div><span style="text-decoration: line-through;">Zephyr:JTool morpheus$ </span><span style="font-weight: bold; text-decoration: line-through;">ls -l Seatbelt\ sandbox\ policy </span></div><div><span style="text-decoration: line-through;">-rw-rw-rw-  1 morpheus  staff  499712 Aug  7 16:56 Seatbelt sandbox policy</span></div><div><span style="text-decoration: line-through;">Zephyr:JTool morpheus$ </span><span style="font-weight: bold; text-decoration: line-through;">file !$ </span></div><div><span style="text-decoration: line-through;">file Seatbelt\ sandbox\ policy </span></div><div><span style="text-decoration: line-through;">Seatbelt sandbox policy: Mach-O kext bundle arm</span></div><div><br/></div><div># BackEndBilly from the forum noted that extraction by name fails on "/" in name,</div><div># (and messy with lots of spaces) so this is now easier, by bundle ID, as of v2.1.1:</div><div>bash-3.2# <span style="font-weight: bold;">./joker -k ~/Documents/iOS/9b/kernel.9b.4S.decrypted | grep MobileFil</span></div><div>0x80728000: AppleMobileFileIntegrity (com.apple.driver.AppleMobileFileIntegrity)</div><div>bash-3.2# <span style="font-weight: bold;">./joker -K com.apple.driver.AppleMobileFileIntegrity  ~/Documents/iOS/9b/kernel.9b.4S.decrypted </span></div><div>This is a 32-bit kernel from iOS 9.x, or later (3216.0.0.1.15)</div><div>Found iOS 8+ sysent table @3eb684 (Addr: 0x803ec684)</div><div>Processing kexts</div><div>Attempting to kextract com.apple.driver.AppleMobileFileIntegrity</div><div>Found com.apple.driver.AppleMobileFileIntegrity at load address: 80728000, offset: 6dd000</div><div>Extracted com.apple.driver.AppleMobileFileIntegrity</div><div>bash-3.2# <span style="font-weight: bold;">file com.apple.driver.AppleMobileFileIntegrity </span></div><div>com.apple.driver.AppleMobileFileIntegrity: Mach-O kext bundle arm</div><div><br/></div><div style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; orphans: auto; widows: auto;">Note that the kernelcache you see in OS X (shoved deep in /System/Library/Caches/com.apple.kext.caches/Startup/kernelcache) is lzss or lzvn (10.10+) compressed, so this won't work there - it doesn't make sense to implement decompression when you have the free floating kexts in /System/Library/Extensions.</span></div><div style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">请注意，你在OS X中看到的内核缓存（随意放在/System/Library/Caches/com.apple.kext.caches/Startup/kernelcache）是lzss或lzvn（10.10+）压缩的，所以当你在/System/Library/Extensions中包含自由浮动的kext时，实现解压缩是没有意义的。</span></div><h3 style="font-family: Tahoma; font-variant-caps: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-family: Tahoma; font-variant-caps: normal; letter-spacing: normal; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">32 and 64-bit (OS X too!)</span></h3><div style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; orphans: auto; widows: auto;">Using </span><span style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; orphans: auto; widows: auto;">-s</span><span style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; orphans: auto; widows: auto;"> will get you a full dump of the </span><span style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; orphans: auto; widows: auto;">__sysctl_set</span><span style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; orphans: auto; widows: auto;"> section. This is useful because the sysctl descriptors have plenty of useful kernel addresses - both of the variables behind the sysctl as well as any handlers:</span></div><div style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">使用-s会让你完成__sysctl_set部分的转储。 这个很有用，因为sysctl描述符有很多有用的内核地址,变量以及一些处理程序：</span></div><div># especially designed to be grep(1) friendly - you can get your sysctl + 6 lines</div><div>Zephyr:JTool morpheus$ <span style="font-weight: bold;">joker -s ~/Documents/iOS/9b/kernel.9b.4S.decrypted | </span></div><div><span style="font-weight: bold;">                                grep -A 6 vnode_enfor</span></div><div>0x80411fc0: security.mac.vnode_enforce  Description: Enforce MAC policy on vnode operations</div><div>                Handler: 0x802b5171</div><div>                Format: IU</div><div>                Parent: 0x80414b90</div><div>                Arg1: 80406028</div><div>                Arg2: 0x0</div><div><br/></div><div style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; orphans: auto; widows: auto;">Oh, and - this works on OS X kernels too.</span></div><div style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">这也同样适用于OS X内核。</span></div><div style="text-indent: 2em; font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-align: start; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="text-indent: 2em; font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; orphans: auto; widows: auto;">Hands down the most useful symbolication is via "-m", which symbolicates Mach traps and UN*X syscalls. </span><span style="text-indent: 2em; font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; orphans: auto; widows: auto;">joker</span><span style="text-indent: 2em; font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; orphans: auto; widows: auto;"> will automatically suppress enosys and "old" syscalls which don't really do anything, but will nonetheless provide you with the addresses:</span></div><div style="text-indent: 2em; font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-align: start; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="text-indent: 2em; font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">最有效处理符号化通过“-m”，它可符号化出着Mach traps和UNIX系统调用。</span><span style="text-indent: 2em; font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">joker 会自动禁止 enosys 和“旧的”系统调用，那些操作不会被执行，但尽管如此仍然会向你提供地址</span></div><div>Zephyr:JTool morpheus$ <span style="font-weight: bold;">joker -a ~/Documents/iOS/9b/kernel.9b.4S.decrypted  | more</span></div><div>Source Version:          3216.0.0.1.15</div><div>This is iOS 9.x, or later</div><div>ARM Exception Vector is at file offset @0xc6000 (Addr: 0x800c7000)</div><div>Found iOS 8+ sysent table @3eb684 (Addr: 0x803ec684)</div><div>Syscalls at address 0x803ec684</div><div>Suppressing enosys (0xffffffff802c14bd) and old (0xffffffff802c14cd)</div><div>1. exit                 802a0f48 T</div><div>2. fork                 802a5734 T</div><div>3. read                 802c14e8 T</div><div>4. write                802c1924 T</div><div>5. open                 800f5344 T</div><div>6. close                80290e68 T</div><div>7. wait4                802a288c T</div><div>9. link                 800f5c70 T</div><div>10. unlink               800f5d24 T</div><div>..</div><div>490. netagent_trigger     80152f38 T</div><div>491. stack_snapshot_with_config 80287fc4 T</div><div>493. grab_pgo_data        80303030 T</div><div>Zephyr:JTool morpheus$$ <span style="font-weight: bold;">joker -m -m -d  ~/Documents/iOS/9b/13A4254v.bin | more</span></div><div>This is a 64-bit Kernel</div><div>Source Version:          3216.0.0.1.15</div><div>This is iOS 9.x, or later</div><div>Syscalls at address 0xffffff8005ef60c0</div><div>Sysent offset in file (for patching purposes):  4f20c0</div><div>Suppressing enosys (0xffffff8005d73640) and old (0xffffff8005d73620)</div><div>1.. exit                 0xffffff8005d49f5c</div><div>2.. fork                 0xffffff8005d4f338</div><div>3.. read                 0xffffff8005d73668</div><div>..</div><div>489.. mremap_encrypted     0xffffff8005d5111c</div><div>490.. netagent_trigger     0xffffff8005bac3f4</div><div>491.. stack_snapshot_with_config 0xffffff8005d29a98</div><div>493.. grab_pgo_data        0xffffff8005dc91b0</div><div># Unexpected bonus - also works on OS X kernels :-)</div><div>Zephyr:JTool morpheus$ <span style="font-weight: bold;">joker -m /System/Library/Kernels/kernel  | grep mmap</span></div><div>This is a 64-bit Kernel</div><div># Albeit not as useful since most symbols are still exported (and there's the KDK)</div><div>197.. mmap                 0xffffff80007c8990</div><div>Zephyr:JTool morpheus$ <span style="font-weight: bold;">jtool -S /System/Library/Kernels/kernel | grep mmap | grep 8990</span></div><div>ffffff80007c8990 T _mmap</div><div><br/></div><h3 style="font-family: Tahoma; font-variant-caps: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-family: Tahoma; font-variant-caps: normal; letter-spacing: normal; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">jtool interoperability:</span></h3><div>与JTool协同使用</div><div style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; orphans: auto; widows: auto;">The latest and greatest feature (besides 64-bit) is JTool support - the latter can now work with "companion files", which are simply text files which follow a simple convention (</span><span style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; orphans: auto; widows: auto;">0xaddress:symbol:comment</span><span style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; orphans: auto; widows: auto;">). You can use the new </span><span style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; orphans: auto; widows: auto;">-j</span><span style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; orphans: auto; widows: auto;"> to auto-create that file</span></div><div style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">最新和最强大的功能（除了64位）是支持JTool - JTool现在可以使用“伴侣文件”，这些简单的文本文件遵循简单约定（0xaddress：symbol：comment）。 你可以使用新的-j自动创建该文件</span></div><div>Zephyr:JTool morpheus$ <span style="font-weight: bold;">joker  -j -m ~/Documents/iOS/9b/13A4254v.bin  </span></div><div>This is a 64-bit Kernel</div><div>Source Version:          3216.0.0.1.15</div><div>This is iOS 9.x, or later</div><div>Opened companion File: /Users/morpheus/Documents/iOS/9b/13A4254v.bin.ARM64.397D09B8-4B9B-3771-ACEE-7143647BD873</div><div>Opening companion file</div><div>Syscalls at address 0xffffff8005ef60c0</div><div>Sysent offset in file (for patching purposes):  4f20c0</div><div>Suppressing enosys (0xffffff8005d73640) and old (0xffffff8005d73620)</div><div>Output written to /Users/morpheus/Documents/iOS/9b/13A4254v.bin.ARM64.397D09B8-4B9B-3771-ACEE-7143647BD873 in Jtool-compatible format. Run jtool with --jtooldir . or set JTOOLDIR=</div><div># File format is crude, I'll admit, but it makes it all the more easier for manual editing</div><div>Zephyr:JTool morpheus$ <span style="font-weight: bold;">head -5 /Users/morpheus/Documents/iOS/9b/13A4254v.bin.ARM64.397D09B8-4B9B-3771-ACEE-7143647BD873 </span></div><div>0xffffff8005d49f5c:exit</div><div>0xffffff8005d4f338:fork</div><div>0xffffff8005d73668:read</div><div>0xffffff8005d73d40:write</div><div>0xffffff8005b33e44:open</div><div># We can now use jtool, since the companion file was created for us - and use symbols from it as we disassemble!</div><div>Zephyr:JTool morpheus$ <span style="font-weight: bold;">jtool -d stack_snapshot_with_config ~/Documents/iOS/9b/13A4254v.bin</span></div><div>Opened companion File: 13A4254v.bin.ARM64.397D09B8-4B9B-3771-ACEE-7143647BD873</div><div>Disassembling from file offset 0x325a98, Address 0xffffff8005d29a98  to next symbol</div><div>stack_snapshot_with_config:</div><div>ffffff8005d29a98        STP    X22, X21, [SP,#-48]!</div><div>ffffff8005d29a9c        STP    X20, X19, [SP,#16]</div><div>ffffff8005d29aa0        STP    X29, X30, [SP,#32]</div><div>ffffff8005d29aa4        ADD    X29, SP, #32; R29 = SP + 0x20</div><div>ffffff8005d29aa8        SUB    X31, X31, #64</div><div>ffffff8005d29aac        MOV    X19, X1</div><div>ffffff8005d29ab0        MOV    X20, X0</div><div>ffffff8005d29ab4        BL     _kauth_cred_get  ; 0xffffff8005d2f300</div><div>ffffff8005d29ab8        MOV    X21, X0</div><div>ffffff8005d29abc        ADD    X8, X21, #1; ..R8 = R21 (0x0) + 0x1 = 0x1 </div><div>ffffff8005d29ac0        CMP    X8, #1</div><div>ffffff8005d29ac4        B.HI   0xffffff8005d29ae0       ; 0xffffff8005d29ae0</div><div>ffffff8005d29ac8        ADRP   X8, 390; -&gt;R8 = 0xffffff8005eaf000 </div><div>ffffff8005d29acc        ADD    X8, X8, #1478; ..R8 = R8 (0xffffff8005eaf000) + 0x5c6 = 0xffffff8005eaf5c6 "kauth_cred_getuid"</div><div>ffffff8005d29ad0        STP    X8, X21, [SP,#0]</div><div>ffffff8005d29ad4        ADRP   x0, 390; -&gt;R0 = 0xffffff8005eaf000 </div><div>ffffff8005d29ad8        ADD    X0, X0, #1454; ..R0 = R0 (0xffffff8005eaf000) + 0x5ae = 0xffffff8005eaf5ae ""%s: bad credential %p""</div><div>ffffff8005d29adc        BL     _panic   ; 0xffffff8005a2b960</div><div>; _panic("%s: bad credential %p", arg2, arg3);</div><div>...</div><div><br/></div><div style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; orphans: auto; widows: auto;">This is especially useful since IDA pro 6.5, for all its amazing features (and hefty price tag) provides this helpful notification when loading a kernel dump : </span></div><div style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">这是特别有用的，因为IDA pro 6.5，它提供的所有其惊人功能（和高价格），在加载内核转储时提供了有用的通知：</span></div><div style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">Mach Traps</span><img src="%E7%9C%8B%E9%9B%AA%E4%B8%83%E6%9C%88%E7%BF%BB%E8%AF%91.resources/5928C9BF-4962-4476-A4E0-C0E8C9BC8C22.png" height="672" width="755"/><br/></div><h3 style="font-family: Tahoma; font-variant-caps: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-family: Tahoma; font-variant-caps: normal; letter-spacing: normal; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Mach Traps</span></h3><div style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; orphans: auto; widows: auto;">lso, Mach traps are back - </span><span style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; orphans: auto; widows: auto;">task_for_pid</span><span style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; orphans: auto; widows: auto;"> is especially useful (to apply the </span><span style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; orphans: auto; widows: auto;">tfp0</span><span style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; orphans: auto; widows: auto;"> patch, which brings back the </span><span style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; orphans: auto; widows: auto;">kernel_task</span><span style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; orphans: auto; widows: auto;"> to userland.</span></div><div style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">另外，Mach traps回来了 - task_for_pid是非常有用的（应用tfp0补丁，把kernel_task带回到用户界面。</span></div><div>$ <span style="font-weight: bold;">./joker -m  /System/Library/Kernels/kernel.3247</span></div><div>This is a 64-bit kernel from OS X 10.11, or later (3247.1.78.0.0)</div><div>mach_trap_table offset in file/memory (for patching purposes): 0x801900/ffffff8000a01900</div><div>Kern invalid should be ffffff8000309000. Ignoring those</div><div> 10 _kernelrpc_mach_vm_allocate_trap         ffffff80002dde60 -</div><div> 12 _kernelrpc_mach_vm_deallocate_trap       ffffff80002ddf10 -</div><div> 14 _kernelrpc_mach_vm_protect_trap          ffffff80002ddfb0 -</div><div> ..</div><div> 93 mk_timer_arm_trap                        ffffff80002f5410 -</div><div> 94 mk_timer_cancel_trap                     ffffff80002f54f0 -</div><div>100 iokit_user_client_trap                   ffffff80008e52d0 -</div><div># On OS X, the above are actually exported, so you can</div><div># verify joker's got it right</div><div>$ <span style="font-weight: bold;">jtool -S !$ | grep ffffff80008e52d0</span></div><div>jtool -S /System/Library/Kernels/kernel.3247 | grep ffffff80008e52d0</div><div>ffffff80008e52d0 T _iokit_user_client_trap</div><div><br/></div><h3 style="font-family: Tahoma; font-variant-caps: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-family: Tahoma; font-variant-caps: normal; letter-spacing: normal; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">MIG Tables</span></h3><div style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; orphans: auto; widows: auto;">Mach uses messages, and message serialization uses MIG. The Mach Interface Generator generates the boilerplate code required for parsing messages, and - as can be expected - leave easily recognizable patterns all over the place. </span><span style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; orphans: auto; widows: auto;">joker</span><span style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; orphans: auto; widows: auto;"> now recognizes the dispatch tables left behind (</span><span style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; orphans: auto; widows: auto;">mig_e</span><span style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; orphans: auto; widows: auto;">), and proceeds to </span><span style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; orphans: auto; widows: auto; font-weight: bold;">symbolicate the functions as well</span><span style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; orphans: auto; widows: auto;">.</span></div><div style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">Mach使用消息，消息序列化使用MIG。 Mach接口生成器生成解析消息所需的样板代码，并且有望在所有地方留下容易识别的模式。 joker现在可以识别留下来的dispatch表（mig_e），并继续符号化这些函数。</span></div><div style="text-indent: 2em; font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-align: start; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="text-indent: 2em; font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; orphans: auto; widows: auto;">Note that the functions symbolicated are the proxies - the actual functions that do the work are called from these. But it's fairly simple to figure out, because the proxies basically call the message check functions, then the ...internal ones.</span></div><div style="text-indent: 2em; font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-align: start; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="text-indent: 2em; font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">请注意，这些调用工作的实际函数是由这些函数所代理 。但这很简单，因为代理基本上调用消息检查函数，然后是内部消息函数。</span></div><div style="text-indent: 2em; font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-align: start; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="text-indent: 2em; font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; orphans: auto; widows: auto;">This is primarily useful for iOS, of course, but all the symbols are stripped there. So the ..internal pattern can be more readily seen with the OS X xnu, wherein the internal functions are exported (but the mig ones from the tables aren’t:</span></div><div style="text-indent: 2em; font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-align: start; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="text-indent: 2em; font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">这主要针对iOS，当然，所有的符号都被剥离了。 因此，内部模式可以用OS X xnu更容易看到，其中内部函数被导出（但是表中的mig函数不是：</span></div><div>host_priv_subsystem is  @0xffffff8000a02a90!</div><div>        0: host_get_boot_info_mig_wrapper: ffffff800032ea60 (400)</div><div>        ..</div><div>_host_subsystem is  @0xffffff8000a030d8!</div><div>        0: host_info_mig_wrapper: ffffff8000332300 (200)</div><div>        19: mach_vm_page_info_mig_wrapper: ffffff8000338cd0 (4819)</div><div>..# Note joker can detected if Apple updates their defs</div><div>        Warning: This kernel is newer than joker is (224 &lt; 227)!</div><div>mach_port_subsystem is  @0xffffff8000a03558!</div><div>        0: mach_port_names_mig_wrapper: ffffff80003346b0 (3200)</div><div>task_subsystem is  @0xffffff8000a04728!</div><div>        0: task_create_mig_wrapper: ffffff800033fec0 (3400)</div><div>        ..</div><div>        41: task_swap_mach_voucher_mig_wrapper: ffffff8000342c50 (3441)</div><div>thread_act_subsystem is  @0xffffff8000a04dd8!</div><div>        0: thread_terminate_mig_wrapper: ffffff8000342f30 (3600)</div><div>        26: thread_set_mach_voucher_mig_wrapper: ffffff8000344d40 (3626)</div><div>        27: thread_swap_mach_voucher_mig_wrapper: ffffff8000344ee0 (3627)</div><div><br/></div><div># Unfortunately, jtool doesn't do x86, so use otool:</div><div>$ <span style="font-weight: bold;">otool -tV /System//Library/Kernels/kernel.3247 |grep -A 100 ffffff8000344ee0  </span></div><div>ffffff8000344ee0        pushq   %rbp</div><div>ffffff8000344ee1        movq    %rsp, %rbp</div><div>ffffff8000344ee4        pushq   %r15</div><div>ffffff8000344ee6        pushq   %r14</div><div>ffffff8000344ee8        pushq   %r13</div><div>ffffff8000344eea        pushq   %r12</div><div>...</div><div>ffffff8000344ee0        pushq   %rbp</div><div>ffffff8000344ee1        movq    %rsp, %rbp</div><div>ffffff8000344ee4        pushq   %r15</div><div>..</div><div>ffffff8000344fe3        movq    %r12, %rsi</div><div>ffffff8000344fe6        callq   _thread_swap_mach_voucher</div><div><br/></div><div style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; orphans: auto; widows: auto;">Again, note I use x86_64 here just to illustrate the idea because you can see the internal function is _thread_swap_mach_voucher, which means joker got the MIG dispatch correctly. To get this on iOS, by cross-correlating ARM64 and x86_64 assembly it's trivial to symbolicate the rest..</span></div><div style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">注意，我用x86_64是为了说明你看到内部的功能是_thread_swap_mach_voucher，这意味着joker正确地得到了MIG调度。 要在iOS上通过交叉相关的ARM64和x86_64程序集得到这个，这是微不足道的</span></div><h3 style="font-family: Tahoma; font-variant-caps: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-family: Tahoma; font-variant-caps: normal; letter-spacing: normal; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Version 3.0β1!</span></h3><div style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; orphans: auto; widows: auto;">With iOS 10 and OS X 12 out, and the kernel segment layout modified, it's time for an improved joker! v3.0 is worthy of a major number increment, because it features integration with my machlib (the engine of </span><a style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; orphans: auto; widows: auto;" href="http://newosxbook.com/tools/disarm.html">disarm</a><span style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; orphans: auto; widows: auto;"> and </span><a style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; orphans: auto; widows: auto;" href="http://newosxbook.com/tools/jtool.html">jtool</a><span style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; orphans: auto; widows: auto;">), which allows </span><span style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; orphans: auto; widows: auto;">joker</span><span style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; orphans: auto; widows: auto;"> to disassemble in order to find functions! Presently I've implemented matching for the "low hanging fruit" (functions taking in strings), but this can be expanded for complex cases and smart pattern matching.</span></div><div style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">随着iOS 10和OS X 12推出，内核段布局修改，是时候改进joker！！ v3.0值得大嘉赞赏，因为它与我的machlib（disarm和jtool引擎）集成在一起，它分离了寻找功能！ 目前，</span><span style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">目前，我已经实现了简单</span><span style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">（功能占用字符串）的匹配，但这可以扩展到复杂的情况和智能模式匹配。</span></div><div style="text-indent: 2em; font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-align: start; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="text-indent: 2em; font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; orphans: auto; widows: auto;">You might be wondering if joker hasn't lost its raison d'être, with Apple (intentionally/accidentally) providing a decrypted kernelcache. I believe it hasn't - namely:</span></div><div style="text-indent: 2em; font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-align: start; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="text-indent: 2em; font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">你可能会想joker会不会失去意义，苹果（有意/不小心）提供一个解密的内核缓存。 我相信不会：</span></div><ul style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><li style="padding: 5px;">kexts are still fused in tight - so you need -k/-K</li><li style="padding: 5px;"><span style="padding: 5px;">* kexts仍然牢固 - 所以你需要-k / -K</span></li><li style="padding: 5px;">Mach Traps &amp; MIG, syscalls and sysctls aren't exported - so you need -m, -s and -S respectively. I've updated the syscall table, btw, for all 520 syscalls, and almost all MIGs.</li><li style="padding: 5px;"><span style="padding: 5px;">* Mach Traps＆MIG，syscalls和sysctls不会导出 - 所以你需要分别使用-m，-s和-S。 我更新了所有520系统调用的系统调用表btw，以及几乎所有的MIG。</span></li><li style="padding: 5px;">A lot of other interesting symbols aren't exported. XNU has O(20k) symbols, of which iOS XNU only exports O(4k) - those needed by kexts</li><li style="padding: 5px;"><span style="padding: 5px;">* 许多其他有趣的符号不会导出。 XNU有O（20k）符号，其中iOS XNU只导出kext所需的符号O（4k） -</span></li></ul><div style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; orphans: auto; widows: auto;">Decompilation is not the usual functionality you'd want, and is also a bit slow. So try </span><span style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; orphans: auto; widows: auto;">-j</span><span style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; orphans: auto; widows: auto;"> and let it take its time. You'll see:</span></div><div style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">解压缩不是你想要的常用功能，而且也有点慢。 所以尝试一下</span><span style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">使用 -j 参数，让它运行</span><span style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">， 你会看到的：</span></div><div>morpheus@Zephyr (~/Documents/iOS/10) %<span style="font-weight: bold;"> joker -j xnu.3757.j99a</span>                                                 13:00</div><div>This is a 64-bit kernel from iOS 10.x, or later (3757.0.0.0.0)</div><div>Opened companion File: xnu.3757.j99a.ARM64.9612A9D5-FA9B-3663-ADD0-C1852BE6674B</div><div>Opening companion file</div><div>Got 4498 syms</div><div>Looking for _secure_monitor ...  Found _secure_monitor at offset 0x7aec</div><div>Looking for _start_cpu ...  Found _start_cpu at offset 0x7018</div><div>Auto-Disassembling __TEXT_EXEC.__text from 0xfffffff00747c000 to find rest</div><div>This may take a little while, but you only need to do this once</div><div>Disassembling from file offset 0x78000, Address 0xfffffff00747c000 </div><div>GOT PE_Parse_boot_argn: 0xfffffff0078db018</div><div>GOT lck_grp_alloc_init: 0xfffffff0074ac1b4</div><div>GOT OSKextLog: 0xfffffff00783bf48</div><div>GOT lck_grp_init: 0xfffffff0074ac1b4</div><div>GOT PE_get_default: 0xfffffff0078db608</div><div>GOT __ZN9IOService15publishResourceEPKcP8OSObject: 0xfffffff007874e88</div><div>GOT __ZN8OSSymbol17withCStringNoCopyEPKc: 0xfffffff007849c28</div><div>GOT __ZN9IOService15publishResourceEPKcP8OSObject: 0xfffffff007849c28</div><div>GOT __ZN9IOService15publishResourceEPKcP8OSObject: 0xfffffff007874e88</div><div>GOT IOLog! 0xfffffff00785b5ec</div><div>ARM Exception Vector is at file offset @0x7b000 (Addr: 0xfffffff00747f000)</div><div>Output written to xnu.3757.j99a.ARM64.9612A9D5-FA9B-3663-ADD0-C1852BE6674B in Jtool-compatible format. </div><div>Run jtool with --jtooldir . or set JTOOLDIR=</div><div># Note that now function starts are also auto imported into companion file..</div><div>morpheus@Zephyr (~/Documents/iOS/10) % <span style="font-weight: bold;">wc -l xnu.3757.j99a.ARM64.9612A9D5-FA9B-3663-ADD0-C1852BE6674B </span>        13:03</div><div>   10791 xnu.3757.j99a.ARM64.9612A9D5-FA9B-3663-ADD0-C1852BE6674B</div><div># All these go into companion file, of course, and you can verify those which ARE exported, like IOLog:</div><div>morpheus@Zephyr (~/Documents/iOS/10) % <span style="font-weight: bold;">jtool -S xnu.3757.j99a| grep IOLog  </span>                                   13:04</div><div>Opened companion File: ./xnu.3757.j99a.ARM64.9612A9D5-FA9B-3663-ADD0-C1852BE6674B</div><div>Loading symbols...</div><div>fffffff00785b5ec T _IOLog # Matches!</div><div>fffffff00785b680 T _IOLogv</div><div><br/></div><div style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; orphans: auto; widows: auto;">In some cases (notable, PE_parse_boot_argn), </span><span style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; orphans: auto; widows: auto;">joker</span><span style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; orphans: auto; widows: auto;"> is more accurate than the actual symbol table, since the exported symbol is a wrapper over the real implementation, which is the one used frequently. </span><span style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; orphans: auto; widows: auto; font-weight: bold;">If you want more symbols supported, let me know </span><a style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; orphans: auto; widows: auto; font-weight: bold;" href="http://newosxbook.com/forum/viewtopic.php?f=3&amp;t=16681">via the website forum, please</a><span style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; orphans: auto; widows: auto;">.</span></div><div style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">在某些情况下（notable，PE_parse_boot_argn），joker比实际的符号表更精确，因为导出的符号是经常使用的一个实际实现的包装器。 如果您想要更多符号支持，请通过网站论坛通知我。</span></div><div style="text-indent: 2em; font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-align: start; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="text-indent: 2em; font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; orphans: auto; widows: auto;">Joker 3.0 also does MACF policies - presently only for Sandbox.kext , as AMFI's is now loaded in code (but *does* do AMFI as well in dumps). This gets the new hooks in Sandbox 570 (which I've highlighted below) and looks like this:</span></div><div style="text-indent: 2em; font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-align: start; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="text-indent: 2em; font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">Joker 3.0也执行MACF策略 - 目前仅适用于Sandbox.kext，</span><span style="text-indent: 2em; font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">因为 AMFI已经加载了代码</span><span style="text-indent: 2em; font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">（但是*does*也可以在转储中执行AMFI）。 这在Sandbox 570中获得了新的钩子（我在下面已经突出显示），看起来像这样：</span></div><div>Zephyr:Sierra morpheus$ <span style="font-weight: bold;">joker /tmp/161.com.apple.security.sandbox.kext</span> </div><div>Found policy at 0xfffffff0055a05d0</div><div>        Policy name: Sandbox</div><div>        Full name of policy: Seatbelt sandbox policy</div><div>        Flags: 0</div><div>        Ops: fffffff0055a0620</div><div>                mpo_cred_check_label_update_execve: 0xfffffff00552a34c</div><div>                ..</div><div>                mpo_mount_check_snapshot_create: 0xfffffff005520970</div><div>                mpo_check_snapshot_delete: 0xfffffff005520a08</div><div>                mpo_vnode_check_clone: 0xfffffff005520aa0</div><div>                mpo_proc_check_get_cs_info: 0xfffffff005520c68 # The Hedgehog hook :-)</div><div>                mpo_proc_check_set_cs_info: 0xfffffff005520d1c</div><div>                mpo_iokit_check_hid_control: 0xfffffff005520d98</div><div>..</div><div>com.apple.security.sandbox(570.0.0.0.0)(570.0.0.0.0)</div><div><br/></div><div style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; orphans: auto; widows: auto;">Other enhancements in 3.0 are </span><span style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; orphans: auto; widows: auto;">JTOOLDIR=...</span><span style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; orphans: auto; widows: auto;"> so you can extract to elsehwere than /tmp, and a couple of really exciting features (like the </span><span style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; orphans: auto; widows: auto; font-weight: bold;">auto-detection of IOUserClients</span><span style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; orphans: auto; widows: auto;">), but that won't be out until the final version. The 2nd Beta adds detection of secure monitor (SMC) and the ARM exception vector, long missing in 64-bit</span></div><div style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">3.0的其他增强功能是JTOOLDIR = ...，所以你也可以提取到除了/tmp的</span><span style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">其他路径</span><span style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">，还有几个非常令人兴奋的功能（如IOUserClients的自动检测），</span><span style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">但是这些功能，在最终版本才会发布出来</span><span style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">。</span><span style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">第二个Beta版本增加</span><span style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">之前在64位一直不支持的</span><span style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">安全监视器（SMC）的检测和ARM异常向量，</span></div><div style="text-indent: 2em; font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-align: start; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="text-indent: 2em; font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; orphans: auto; widows: auto;">I use </span><span style="text-indent: 2em; font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; orphans: auto; widows: auto;">joker</span><span style="text-indent: 2em; font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; orphans: auto; widows: auto;"> extensively (and exclusively, for lack of IDA) when writing my notes from iOS/OSX, </span><a style="text-indent: 2em; font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; orphans: auto; widows: auto;" href="http://newosxbook.com/Articles/10-10.12.html">now in its third year</a><span style="text-indent: 2em; font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; orphans: auto; widows: auto;">, and I hope you find it useful.</span></div><div style="text-indent: 2em; font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-align: start; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="text-indent: 2em; font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">在iOS / OSX上编写笔记时，我广泛使用joker（而且完全缺少IDA）</span><span style="text-indent: 2em; font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">三年了</span><span style="text-indent: 2em; font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">，</span><span style="text-indent: 2em; font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">我希望你也能觉得它是有用的</span><span style="text-indent: 2em; font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">。</span></div><div style="border: 1px solid red; padding: 10px; background-color: yellow; box-shadow: rgb(136, 136, 136) 5px 5px 2px; font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="border: 1px solid red; padding: 10px; background-color: yellow; box-shadow: rgb(136, 136, 136) 5px 5px 2px; font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Again, if you encounter a bug/need a feature, don't just dismiss this and fire up IDA - tell me, and I'll gladly fix/add. I build my tools around my use cases, which is why I can't get everything</span></div><h3 style="font-family: Tahoma; font-variant-caps: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-family: Tahoma; font-variant-caps: normal; letter-spacing: normal; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">再次申明，如果你遇到一个bug或者需要一个功能，不要丢弃joker并且启动IDA - 告诉我，我会很乐意修复/添加。 我围绕我的用例构建我的工具，这就是</span><span style="font-family: Tahoma; font-variant-caps: normal; letter-spacing: normal; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 16px; font-weight: bold;">为什么</span><span style="font-family: Tahoma; font-variant-caps: normal; letter-spacing: normal; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 16px; font-weight: bold;">不能适用所有场景</span></h3><h3 style="font-family: Tahoma; font-variant-caps: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-family: Tahoma; font-variant-caps: normal; letter-spacing: normal; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Version 3.0β2!</span></h3><ul><li style="padding: 5px; font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Now gets names of all kexts right, by either method #1 or method #2</li><li style="padding: 5px; font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="padding: 5px; font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">通过方法1或方法2，现在可以获取所有kexts的正确名称</span></li><li style="padding: 5px; font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Fixed that Annoying ID=... bug I had</li><li style="padding: 5px; font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="padding: 5px; font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">修复id的bug</span></li><li style="padding: 5px; font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">joker now auto-symbolicates stubs in kexts!!! (most) stubs point to exported symbols in the kernel proper, and thanks to AAPL we now have those exports! joker auto follows the disassembly of stubs, e.g.</li><li style="padding: 5px; font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="padding: 5px; font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">joker现在自动符号在kexts中存根！ （大多数）存根指向内核中的导出符号，并且由于AAPL，我们现在有这些出口！ joker自动跟随存根展开，例如</span></li></ul><div>fffffff00552fa64        ADRP   X16, 113                 ; -&gt;R16 = 0xfffffff0055a0000 </div><div>fffffff00552fa68        LDR    X16, [X16, #0]   ; -R16 = *(R16 + 0) =  *(0xfffffff0055a0000) = 0xfffffff007843ae4 ... ?..</div><div>fffffff00552fa6c        BR     X16                              ;  0xfffffff007843ae4</div><div><br/></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">As you can see, machlib can follow the registers, and figure out the addresses. So, if the symbol for what's in X16 is exported, you can find it easily:</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">如你所见，machlib可以跟随寄存器，并找出地址。 因此，如果在 X16 中暴露出来的符号，您可以轻松找到它：</span></div><div>morpheus@Zephyr (~)$ <span style="font-weight: bold;">jtool -S ~/Documents/iOS/10/xnu.3705.j99a | grep fffffff007843ae4</span></div><div>fffffff007843ae4 T _IOFree</div><div><br/></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">But.. why should you need to do this yourself? joker now does this automatically!</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">但是，为什么你要亲自去查找呢？ joker现在可以自动完成！</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">morpheus@Zephyr (~)$ </span><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em; font-weight: bold;">joker -K com.apple.security.sandbox ~/Documents/iOS/10/xnu.3705.j99a</span></div><div>This is a 64-bit kernel from iOS 10.x, or later (3705.0.0.2.3)</div><div>ARM Exception Vector is at file offset @0x7b000 (Addr: 0xfffffff00747f000)</div><div>Found com.apple.security.sandbox at load address: 551c000, offset: 1a8c000</div><div>Writing kext out to /tmp/com.apple.security.sandbox.kext</div><div>Symbolicating stubs for com.apple.security.sandbox  from off 0x13a64</div><div># Note that there are still symbols that are not exported by XNU, but ARE linked from stubs</div><div>Unable to resolve kernel symbol at fffffff0040e4e84</div><div>..</div><div>Symbolicated stubs to /tmp/com.apple.security.sandbox.kext.ARM64.00066DE6-8BDC-36E0-90CD-A872522D821</div><div>morpheus@Zephyr (~)$ <span style="font-weight: bold;">cat  /tmp/com.apple.security.sandbox.kext.ARM64.00066DE6-8BDC-36E0-90CD-A872522D8211 </span></div><div>fffffff00552fa64:_IOFree.stub</div><div>fffffff00552fa70:_IOMalloc.stub</div><div>..</div><div>fffffff00552faac:_PE_i_can_has_debugger.stub</div><div>...</div><div>fffffff00552fff8:_sock_gettype.stub</div><div>morpheus@Zephyr (~)$ <span style="font-weight: bold;">jtool -d /tmp/com.apple.security.sandbox.kext | grep "^; _panic"</span></div><div>Opened companion File: /tmp/com.apple.security.sandbox.kext.ARM64.00066DE6-8BDC-36E0-90CD-A872522D8211</div><div>Loading symbols...</div><div>Disassembling from file offset 0x770, Address 0xfffffff00551c770 </div><div>; _panic.stub("released collection's reference to profile");</div><div>; _panic.stub("cannot register builtin profile with no name");</div><div>; _panic.stub("failed to initialize platform sandbox");</div><div>; _panic.stub("unexpected filter type");</div><div>; _panic.stub("sfree on invalid allocation at %p"0xfe);</div><div>; _panic.stub("no profile to evaluate");</div><div>; _panic.stub("%s: matchlen (%zu) &gt; pathlen (%zu)\n""(null)");</div><div>; _panic.stub("%s: failed to allocating matching dict""(null)");</div><div>; _panic.stub("%s: failed to lookup AMFI service\n""(null)");</div><div>; _panic.stub("failed to allocate OSSymbol for string \"%s\"""(null)");</div><div><br/></div><div>Zeng BanXian - this one's for you :-)</div><h3 style="font-family: Tahoma; font-variant-caps: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-family: Tahoma; font-variant-caps: normal; letter-spacing: normal; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Version 3.0β3!</span></h3><div style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; orphans: auto; widows: auto;">Minor but useful change: If you feed joker an uncompressed (decrypted) kernelcache it will still complain, but will extract the KPP Mach-O at its end for you to /tmp. Still no reliable split-kexts, but I'm almost there (got other KPP-ressing matters to deal with..). Get beta </span><a style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; orphans: auto; widows: auto;" href="http://newosxbook.com/files/joker3b3.tar">here</a><span style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; orphans: auto; widows: auto;">.</span></div><div style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">小而有用的改变：如果你给joker一个未压缩（解密）kernelcache，</span><span style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">它仍会显示警告信息，</span><span style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">最后会将KPP Mach-O提取到/ tmp。</span><span style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">虽然现在仍然没有可靠的split-kexts</span><span style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">，但是我快完成它了（还有其他的KPP-ressing事情要处理..）。</span></div><h3 style="font-family: Tahoma; font-variant-caps: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-family: Tahoma; font-variant-caps: normal; letter-spacing: normal; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Version 3.0β3!</span></h3><ul style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><li style="padding: 5px;">Split Kexts (iOS 10b2+)</li></ul><h3 style="font-family: Tahoma; font-variant-caps: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-family: Tahoma; font-variant-caps: normal; letter-spacing: normal; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Version 3.1</span></h3><ul><li style="padding: 5px; font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Operates directly on a compressed kernelcache. I used the LZSS.c code from Apple's old iBoot. Also, ARM64 version is back, so you can run it on an iOS10 64-bit device directly!</li><li style="padding: 5px; font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="padding: 5px; font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">直接在压缩的kernelcache上运行。 我使用apple旧版iBoot的LZSS.c代码。 此外，ARM64版本回来了，所以您可以直接在iOS10 64位设备上运行它！</span></li><div><img src="%E7%9C%8B%E9%9B%AA%E4%B8%83%E6%9C%88%E7%BF%BB%E8%AF%91.resources/EDC472EE-55D1-4FDE-86E1-8DBFEDC3AD72.png" height="460" width="1361"/><br/></div></ul><h3 style="font-family: Tahoma; font-variant-caps: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-family: Tahoma; font-variant-caps: normal; letter-spacing: normal; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Version 3.2</span></h3><ul><li style="padding: 5px; font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Joker gets in the zone - Mach zones, that is:</li></ul><div>morpheus@Zephyr (~/Documents/Work/JTool) % <span style="font-weight: bold;">./joker -j ~/Downloads/kernelcache.release.n66</span></div><div>Feeding me a compressed kernelcache, eh? That's fine, now. I can decompress! (Type -dec _file_ if you want to save to file)!</div><div>Compressed Size: 12537772, Uncompressed: 24854528. Unknown (CRC?): 0x95944450, Unknown 1: 0x1</div><div>btw, KPP is at 12538208 (0xbf5160)..And I saved it for you in /tmp/kpp</div><div>Got kernel at 437</div><div>This is a 64-bit kernel from iOS 10.x (b7+), or later (3789.32.1.0.0)</div><div>Opened companion File: /Users/morpheus/Downloads/kernelcache.release.n66.ARM64.977182E2-2525-386E-8808-457275346A3E</div><div>Opening companion file</div><div>Found _secure_monitor at offset 0x7b0c, Addr: 0xfffffff007087b0c</div><div>Found _start_cpu at offset 0x7018, Addr: 0xfffffff007087018</div><div>Auto-Disassembling __TEXT_EXEC.__text from 0xfffffff007080000 to find rest..</div><div>This may take a little while, but you only need to do this once</div><div>Disassembling from file offset 0x7c000, Address 0xfffffff007080000 </div><div>GOT zinit: 0xfffffff0070e5700</div><div>GOT PE_Parse_boot_argn: 0xfffffff0074e5a40</div><div>GOT zp_factor: 0xfffffff007556340</div><div>GOT PE_Parse_boot_argn: 0xfffffff0074e5a40</div><div>GOT zp_scale: 0xfffffff007556344</div><div>fffffff007585568:vm objects zone</div><div>fffffff0075711f0:vm object hash entries zone</div><div>fffffff007570cd0:maps zone</div><div>fffffff007570b10:Reserved VM map entries zone</div><div>fffffff007570cc0:VM map copies zone</div><div>fffffff007570b18:VM map holes zone</div><div>fffffff00758ad60:pmap zone</div><div>fffffff007588bb0:vm pages array zone</div><div>fffffff007588bb8:vm pages zone</div><div>GOT lck_grp_alloc_init: 0xfffffff0070b23a8</div><div>fffffff007570a90:mem_obj_control zone</div><div>fffffff007570a70:device node pager structures zone</div><div>fffffff007556338:waitq sets zone</div><div>fffffff007537300:ipc spaces zone</div><div>fffffff0075372d0:ipc ports zone</div><div>fffffff0075372d8:ipc port sets zone</div><div>fffffff0075372c0:ipc kmsgs zone</div><div>fffffff007538428:ipc vouchers zone</div><div>fffffff007538420:ipc voucher attr controls zone</div><div>fffffff007537150:ipc task importance zone</div><div>... you get the idea</div><div><br/></div><h2 style="font-size: x-large; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: silver;"><span style="font-size: x-large; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: silver;">Version 3.99 </span></h2><div>- Not 4.0 because I still don't have USerClients working - Updated for iOS 11 β (Still not tested on MacOS 13, but should work) - Sandbox decomp likely broken (haven't tested, but there are more operation names , like dynamic-code-generation...I know, I'll fix it)</div><div>-因为我还没有使用USerClients，所以不是4.0 - 增加了iOS 11β的兼容（仍然没有在MacOS 13测试过，但应该工作） - 沙盒解压容易崩溃（没有测试，但有更多的操作名称，如动态代码生成...我知道，我会解决它）</div><div>morpheus@Chimera (~/Documents/Work/JTool) %./joker.universal -s ~/Downloads/kernelcache.release.ipad4 </div><div>Feeding me a compressed kernelcache, eh? That's fine, now. I can decompress! (Type -dec _file_ if you want to save to file)!</div><div>Compressed Size: 12693336, Uncompressed: 24969216. Unknown (CRC?): 0xc809f8d1, Unknown 1: 0x1</div><div>btw, KPP is at 12693775 (0xc1b10f)..And I saved it for you in /tmp/kpp</div><div>Got kernel at 440</div><div>This is a 64-bit kernel from iOS 11.x (b1+), or later (4397.0.0.2.4)</div><div># </div><div># Note also - as apparently two new Mach traps</div><div># KPP updated (haven't checked yet, so not sure it will defeat Luca's bypass, but nice AAPL are trying)</div><div>#</div><div>...</div><div>186.. thread_selfcounts    0xfffffff0071a6c7c</div><div>..</div><div>375.. kevent_id            0xfffffff0073cb0d0</div><div>...</div><div>520.. terminate_with_payload 0xfffffff0073efdac</div><div>521.. abort_with_payload   0xfffffff0073d9410</div><div>522.. necp_session_open    0xfffffff0072465e8</div><div>523.. necp_session_actrion 0xfffffff00724c538</div><div>524.. setattrlistat        0xfffffff0071ae720</div><div>525.. net_qos_guideline    0xfffffff0072d85c4</div><div>526.. fmount               0xfffffff0071cf0a0</div><div>527.. ntp_adjtime          0xfffffff007466ba4</div><div>528.. ntp_gettime          0xfffffff007466a30</div><div>529.. os_fault_with_payload 0xfffffff0073d9468</div><div><br/></div><div><br/></div><h2 style="font-size: x-large; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: silver;"><span style="font-size: x-large; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: silver;">Download</span></h2><div><a style="color: rgb(0, 0, 0);" href="http://newosxbook.com/tools/joker.tar">Right here (Universal: OSX 64, iOS 32/64, and Linux 64)</a></div><div><a style="color: rgb(0, 0, 0);" href="http://newosxbook.com/src.jl?tree=listings&amp;file=joker.c">Source</a><span style="color: rgb(0, 0, 0);"> Caveat: Won't compile without machlib.</span></div><h3>ChangeLog</h3><div>更新日志</div><div>v3.99 - update and minor fix for iOS 11β1</div><div>针对 iOS11β1 的更新和小问题的修复<br/></div><div>v3.2 - decompilation now successfully gets all zones by decompiling zinit and tracking the return value to globals</div><div>通过反编译zinit，并将返回值跟踪到全局变量，现在可以成功获取所有区域 </div><div>v3.1 - works on compressed kernelcaches (not iPhone 7 bvx2 (LZFSE), but classic complzss)</div><div>可运行压缩的内核缓存（不是iPhone 7 bvx2（LZFSE），是classic complzss）</div><div>v3.0 - kext support, split kext, MACF Policies, and preliminary sandbox decomp</div><div>支持kext，分离kext，MACF策略和初步沙箱解压</div><div>-- Minor fix to specify output dir for kextraction, as JOKER_DIR=</div><div>微小修复，可以指定kextraction的输出目录，如JOKER_DIR =</div><div>-- validation on memem in case signature can't be found..</div><div>修复某些情况签名验证无法找到..</div><div><br/></div><div>v2.3 - Almost fully integrated with MachLib - Correctly identifies all kexts, even in a dump</div><div>几乎完全集成MachLib - 正确识别所有的kext，即使在转储</div><div>v2.2.1 - kextraction on 64 bit works! Can also ID the kexts, despite absence of __PRELINK_INFO. Use "all" for all kexts.</div><div>kextraction支持64位！ 即使没有__PRELINK_INFO，也可以对kext进行身份验证。 对所有kext使用“all”。</div><div>v2.1.1 - preliminary kextraction from a 64 bit dump (sans __PRELINK_INFO), and fix for Billy's Bug</div><div>初步支持64位（sans __PRELINK_INFO）kextraction转储，并修复Billy的Bug</div><div>v2.1 - (re)Added Mach trap table, MIG subsystems (+150 symbols!)</div><div>（re）添加Mach trap表，MIG子系统（+150符号！）</div><div>v2.0 - jtool integration (write to companion file)</div><div>jtool集成（写入伴随文件）</div><div><br/></div><div><br/></div><h3>Greets</h3><ul><li style="padding: 5px; font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">BackEndBilly (for telling me about the kext extraction bug)</li><li style="padding: 5px; font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Xerub</li><li style="padding: 5px; font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">John Doe</li></ul><h3 style="font-family: Tahoma; font-variant-caps: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-family: Tahoma; font-variant-caps: normal; letter-spacing: normal; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Finger</span></h3><ul><li style="padding: 5px; font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">i0n1c</li></ul><h3 style="font-family: Tahoma; font-variant-caps: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-family: Tahoma; font-variant-caps: normal; letter-spacing: normal; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">License, etc</span></h3><div style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; orphans: auto; widows: auto;">Use it at will. You have my blessing, and I won't complain. A nice thank you would be appreciate if you find it useful, as well as feature requests, if you have any.</span></div><div style="text-indent: 2em; font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-align: start; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="text-indent: 2em; font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; orphans: auto; widows: auto;">joker</span><span style="text-indent: 2em; font-family: Tahoma; font-size: 16px; font-variant-caps: normal; letter-spacing: normal; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; orphans: auto; widows: auto;"> is open source, so you can see the patterns in the kernelcache it locks on in order to its work. Machlib (its dependency) isn't, but I can license the latter if you're interested.</span></div><div><br/></div></body></html>